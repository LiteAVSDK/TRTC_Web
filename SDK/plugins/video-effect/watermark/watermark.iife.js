"use strict";var Watermark=(()=>{var g=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var x=(r,e,t)=>e in r?g(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var M=(r,e)=>{for(var t in e)g(r,t,{get:e[t],enumerable:!0})},f=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of P(e))!y.call(r,a)&&a!==t&&g(r,a,{get:()=>e[a],enumerable:!(i=C(e,a))||i.enumerable});return r};var L=r=>f(g({},"__esModule",{value:!0}),r);var T=(r,e,t)=>(x(r,typeof e!="symbol"?e+"":e,t),t);var V={};M(V,{Watermark:()=>A,default:()=>k});function D(r){return{name:"WatermarkOptions",type:"object",required:!0,allowEmpty:!1,properties:{imageUrl:{required:!0,type:"string"},x:{required:!1,type:"number"},y:{required:!1,type:"number"},size:{required:!1,type:["string","object","number"]}},validate(e,t,i,a){var d;let{RtcError:o,ErrorCode:p,ErrorCodeDictionary:s}=r.errorModule;if(!e)return;let{imageUrl:n}=e,m=n.split("?")[0].split(".").pop();if((m==="jpg"||m==="jpeg")&&r.log.warn("The image format is not recommended to be jpg/jpeg, because the format does not support transparency."),!((d=r.room.videoManager.cameraTrack)!=null&&d.mediaTrack))throw new o({code:p.INVALID_OPERATION,extraCode:s.INVALID_OPERATION_NEED_VIDEO,fnName:i});if(r.utils.isString(e.size)&&e.size!=="contain"&&e.size!=="cover")throw new o({code:p.INVALID_PARAMETER,extraCode:s.INVALID_PARAMETER_TYPE,message:"The size parameter must be 'contain' or 'cover'",fnName:i});if(r.utils.isNumber(e.size)&&(e.size<=0||e.size>1))throw new o({code:p.INVALID_PARAMETER,extraCode:s.INVALID_PARAMETER_RANGE,message:"The size parameter must be greater than 0",fnName:i});if(r.utils.isObject(e.size)){if(!e.size.width||!e.size.height)throw new o({code:p.INVALID_PARAMETER,extraCode:s.INVALID_PARAMETER_TYPE,message:"The size parameter must be an object with width and height properties",fnName:i});if(e.size.width<=0||e.size.height<=0)throw new o({code:p.INVALID_PARAMETER,extraCode:s.INVALID_PARAMETER_RANGE,message:"The size parameter must be greater than 0",fnName:i})}}}}function R(r){return{name:"StopWatermarkOptions",required:!1}}var E=0,A=class{constructor(e){this.core=e;T(this,"seq");T(this,"_core");T(this,"log");T(this,"startResolve");T(this,"startReject");E=E+1,this.seq=E,this._core=e,this.log=e.log.createChild({id:`${this.getAlias()}${E}`}),this.log.info("created")}getName(){return"Watermark"}getAlias(){return"w"}getValidateRule(e){switch(e){case"start":return D(this._core);case"update":return R(this._core);case"stop":return R(this._core)}}getGroup(){return"w"}async start(e){return this.doStart(e)}async update(e){return await this.stop(),this.doStart(e)}async stop(){return this._core.room.videoManager.deleteWatermark()}async doStart(e){let{imageUrl:t,x:i=0,y:a=0,size:o="cover"}=e,{settings:p}=this._core.room.videoManager.cameraTrack,s;try{s=await this._core.utils.loadImage(t)}catch(B){let{RtcError:N,ErrorCode:U}=this.core.errorModule;throw new N({code:U.INVALID_PARAMETER,message:`load image failed, url: ${t}`})}let{width:n,height:u}=p,{width:m,height:d}=s,l=m,c=d;this._core.utils.isObject(o)&&(l=(o==null?void 0:o.width)||l,c=(o==null?void 0:o.height)||c),this._core.utils.isNumber(o)&&(l=m*o,c=d*o);let b=m/d,h=n/u,I=b>h;o==="contain"&&(I?(l=n,c=n/b):(l=u*b,c=u)),o==="cover"&&(I?(c=u,l=u*b):(l=n,c=n/b));let S=document.createElement("canvas"),_=S.getContext("2d");S.width=Math.min(n-i,m),S.height=Math.min(u-a,d),_==null||_.drawImage(s,0,0,l,c);let O=new Image;return O.src=S.toDataURL("image/png"),this._core.room.videoManager.setWatermark({x:i,y:a,width:Math.min(n-i,m),height:Math.min(u-a,d),imageUrl:t,imageElement:O})}};var k=A;return L(V);})().default;
